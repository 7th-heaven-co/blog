# ğŸ“˜ DEV.md â€” Developer Reference

> **Fast checklist + file map for maintainers**

---

## âœ… 1Â Â·Â GitHub Secrets
_Add under **RepoÂ Settings â†’ Secrets & Variables â†’ Actions**_

| Secret                               | Purpose                                                            |
| ------------------------------------ | ------------------------------------------------------------------ |
| `NPM_TOKEN`                          | Authenticate semanticâ€‘release to create Git tags & GitHub releases |
| `CLOUDFLARE_API_TOKEN`               | Directâ€‘upload token for WranglerÂ Action and purge script           |
| `CLOUDFLARE_ACCOUNT_ID`              | Cloudflare account identifier                                      |
| `CLOUDFLARE_ZONE_ID`                 | Zone used only by purge script (not Wrangler deploy)               |
| `X_API_KEY` / `X_API_SECRET`         | X DeveloperÂ API app credentials                                    |
| `X_ACCESS_TOKEN` / `X_ACCESS_SECRET` | OAuth user credentials for posting                                 |
| `CODECOV_TOKEN` (opt.)               | Upload privateâ€‘repo coverage                                       |

> **Note:** `GITHUB_TOKEN` is autoâ€‘generated by Actionsâ€”no need to add it.

---

## ğŸ”’ 2Â Â·Â Branch protection rules

### `main`
- âœ… Require PR with **1 approval**
- âœ… Require CI: **buildÂ + testÂ + deploy** checks
- âœ… Dismiss stale reviews, include admins

### `staging`
- âœ… Same as `main`, plus **require status check: semanticâ€‘release**

### `dev`
- â– Optional protection; direct commits allowed for solo dev, but PRs recommended

### `release/*` (optional rule)
- âœ… Require PR to merge into `main`

---

## ğŸŒ 3Â Â·Â Cloudflare Pages settings

| Setting               | Value                  |
| --------------------- | ---------------------- |
| **Production branch** | `main`                 |
| **Preview branches**  | `staging`, `preview/*` |
| **Build command**     | `npm run build`        |
| **Build output**      | `dist/`                |

WranglerÂ Action handles deploys in CI; Pages dashboard is fallback.

---

## ğŸ—‚ 4Â Â·Â Key project files

| Path                               | Purpose                                                                |
| ---------------------------------- | ---------------------------------------------------------------------- |
| `.releaserc.json`                  | semanticâ€‘release config (ignores `post:` commits)                      |
| `.npmrc`                           | lockfile settings + registry                                           |
| `.dev.vars.sample` / `.env.sample` | Environment templates                                                  |
| `biome.json`                       | Linter & formatter rules                                               |
| `scripts/`                         | Helper Node scripts (deploy, purge, createâ€‘releaseâ€‘branch, X announce) |
| `.github/workflows/`               | CI workflows (tests, release, deploy)                                  |

---

## ğŸ” 5Â Â·Â Script cheatâ€‘sheet

| Script                     | What it does                                                         |
| -------------------------- | -------------------------------------------------------------------- |
| `deploy-from-changelog.js` | Parses CHANGELOG.md â†’ decides if Pages build & zoneâ€‘purge are needed |
| `create-release-branch.js` | Weekly cron: branch `release/YYYYâ€‘MMâ€‘DD` + open PR                   |
| `purge-history.js`         | Logs invalidated paths to KV                                         |
| `x-announce.js`            | Posts new releases to X after production deploy                      |
| `generate-sitemap.js`      | Builds incremental sitemap for changed posts                         |

---

Happy hacking! ğŸ’œ

