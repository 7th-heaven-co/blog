# 🧹 Purge Cloudflare Cache from Paths

This GitHub Action automatically triggers a cache purge on your Cloudflare Worker whenever specific blog pages (or other site paths) are updated or deleted.

---

## ⚙️ Trigger Conditions

This workflow runs when:

- `scripts/parsed-paths.json` is committed to the `staging` branch
- Or when triggered manually via `workflow_dispatch`

---

## 📂 File: `scripts/parsed-paths.json`

This file must be created prior to this workflow running. It typically looks like:

```json
{
  "updatedPaths": ["/blog/new-post", "/about"],
  "deletedPaths": ["/blog/old-post"]
}
```

It’s generated by the `deploy-from-changelog.js` script during the content deploy step.

---

## 🔐 Required Secrets

| Secret Key      | Description                                      |
|------------------|--------------------------------------------------|
| `CF_PURGE_URL`   | Full URL to your Cloudflare Worker purge endpoint |

---

## ✅ What This Workflow Does

1. **Reads** `updatedPaths` and `deletedPaths` from `parsed-paths.json`
2. **Combines** both arrays into a single `paths` array
3. If `paths` is not empty:
   - Sends a `POST` request to your Cloudflare Worker with the following payload:
     ```json
     { "paths": ["/blog/page-a", "/blog/page-b"] }
     ```
4. If empty:
   - Skips the purge to avoid sending an unnecessary request

---

## 🧠 Notes

- Paths are purged via your Worker, which should handle cache invalidation on Cloudflare
- The JSON payload must be valid — this workflow ensures safe formatting
- Supports both manual and push-based triggers

---

## 🧪 Testing Tips

- Add dummy data to `parsed-paths.json`
- Run the workflow manually
- Watch the output for a successful `curl` POST or a skip message