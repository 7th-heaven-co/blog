# 📘 DEV.md — Developer Reference

> **Fast checklist + file map for maintainers**

---

## ✅ 1 · GitHub Secrets
_Add under **Repo Settings → Secrets & Variables → Actions**_

| Secret                               | Purpose                                                            |
| ------------------------------------ | ------------------------------------------------------------------ |
| `NPM_TOKEN`                          | Authenticate semantic‑release to create Git tags & GitHub releases |
| `CLOUDFLARE_API_TOKEN`               | Direct‑upload token for Wrangler Action and purge script           |
| `CLOUDFLARE_ACCOUNT_ID`              | Cloudflare account identifier                                      |
| `CLOUDFLARE_ZONE_ID`                 | Zone used only by purge script (not Wrangler deploy)               |
| `X_API_KEY` / `X_API_SECRET`         | X Developer API app credentials                                    |
| `X_ACCESS_TOKEN` / `X_ACCESS_SECRET` | OAuth user credentials for posting                                 |
| `CODECOV_TOKEN` (opt.)               | Upload private‑repo coverage                                       |

> **Note:** `GITHUB_TOKEN` is auto‑generated by Actions—no need to add it.

---

## 🔒 2 · Branch protection rules

### `main`
- ✅ Require PR with **1 approval**
- ✅ Require CI: **build + test + deploy** checks
- ✅ Dismiss stale reviews, include admins

### `staging`
- ✅ Same as `main`, plus **require status check: semantic‑release**

### `dev`
- ➖ Optional protection; direct commits allowed for solo dev, but PRs recommended

### `release/*` (optional rule)
- ✅ Require PR to merge into `main`

---

## 🌐 3 · Cloudflare Pages settings

| Setting               | Value                  |
| --------------------- | ---------------------- |
| **Production branch** | `main`                 |
| **Preview branches**  | `staging`, `preview/*` |
| **Build command**     | `npm run build`        |
| **Build output**      | `dist/`                |

Wrangler Action handles deploys in CI; Pages dashboard is fallback.

---

## 🗂 4 · Key project files

| Path                               | Purpose                                                                |
| ---------------------------------- | ---------------------------------------------------------------------- |
| `.releaserc.json`                  | semantic‑release config (ignores `post:` commits)                      |
| `.npmrc`                           | lockfile settings + registry                                           |
| `.dev.vars.sample` / `.env.sample` | Environment templates                                                  |
| `biome.json`                       | Linter & formatter rules                                               |
| `scripts/`                         | Helper Node scripts (deploy, purge, create‑release‑branch, X announce) |
| `.github/workflows/`               | CI workflows (tests, release, deploy)                                  |

---

## 🔍 5 · Script cheat‑sheet

| Script                     | What it does                                                         |
| -------------------------- | -------------------------------------------------------------------- |
| `deploy-from-changelog.js` | Parses CHANGELOG.md → decides if Pages build & zone‑purge are needed |
| `create-release-branch.js` | Weekly cron: branch `release/YYYY‑MM‑DD` + open PR                   |
| `purge-history.js`         | Logs invalidated paths to KV                                         |
| `x-announce.js`            | Posts new releases to X after production deploy                      |
| `generate-sitemap.js`      | Builds incremental sitemap for changed posts                         |

---

Happy hacking! 💜

